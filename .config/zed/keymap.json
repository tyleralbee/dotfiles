// Rule of thumb - choose binds based on their CONTEXT:
//
// | MODIFIER | CONTEXT                 | IMPLICATION                                                | EXAMPLE CONTEXTS   |
// | -------- | ----------------------- | ---------------------------------------------------------- | ------------------ |
// | `super`  | SYSTEM  (e.g. Hyprland) | The bind will work regardless of which program is in focus | OS, window manager |
// | `alt`    | PROCESS (e.g. Zed)      | The program in focus will handle the bind                  | Application        |
// | `ctrl`   | THREAD  (e.g. Vim)      | A subprocess of the program in focus will handle the bind  | Plugin, website    |
//
// - Use `shift` in tandem with `super`, `alt`, or `ctrl` for related binds.
// - `shift` binds are less common and/or more impactful than those without.
//
// Examples:
//
// - Use Hyprland to focus an app with `super-a`; open a new instance of the app with `super-shift-a`
// - Use Zed to open a file with `alt-o`; open the file in a new window with `alt-shift-o`
// - Use Vim to scroll up with `ctrl-u`; scroll to the top of the file with `ctrl-shift-u`
//
// Deviate from this rule of thumb for ubiquitous binds:
//
// - `ctrl-c`: Copy
// - `ctrl-f`: Find
// - `ctrl-n`: New Window
// - `ctrl-q`: Quit
// - `ctrl-t`: New Tab
// - `ctrl-v`: Paste
// - `ctrl-w`: Close
// - `ctrl-x`: Cut
// - `ctrl-z`: Undo
//
// Notable changes resulting from the above include, but are not limited to:
//
// - Vim motions (most importantly, `ctrl-w`)
// - Terminal binds (PROCESS binds should be on `alt` anyways)
//
// Non-compliant binds below are marked with üö©
// Binds to be removed are marked with üèÅ
[
    {
        "bindings": {
            "alt-a": null, // Zed prefix key
            "ctrl-shift-c": null, // was: collaborator panel

            "alt-,": ["task::Spawn", { "task_name": "Open settings" }],
            "alt-.": ["task::Spawn", { "task_name": "Open keymap" }],
            "alt-/": ["task::Spawn", { "task_name": "Open tasks" }],
            "alt-<": "zed::OpenDefaultSettings",
            "alt->": "zed::OpenDefaultKeymap",
            "alt-p": "file_finder::Toggle",
            "alt-shift-/": "vim::OpenDefaultKeymap",
            "alt-shift-a": "agent::ToggleFocus",
            "alt-shift-g": "git_panel::ToggleFocus",
            "alt-shift-p": "command_palette::Toggle",

            // Project file search, command palette
            "alt-j": "menu::SelectNext",
            "alt-k": "menu::SelectPrevious"
        }
    },
    {
        "context": "Workspace",
        "bindings": {
            "alt-a ctrl-r": "git::Restore",
            "alt-a ctrl-y": "editor::CopyFileName",
            "alt-a x": "pane::CloseActiveItem",

            // Pane navigation & toggles
            "alt-[": "workspace::ToggleLeftDock", // üèÅ
            "alt-]": "workspace::ToggleRightDock", // üèÅ
            "alt-h": "workspace::ActivatePaneLeft",
            "alt-l": "workspace::ActivatePaneRight",
            "alt-shift-h": "workspace::ToggleLeftDock",
            "alt-shift-l": "workspace::ToggleRightDock",
            "ctrl-shift-i": "workspace::ToggleBottomDock" // üö© open Firefox devtools
        }
    },
    {
        "context": "Editor",
        "bindings": {
            "alt-space": "editor::ShowCompletions",
            "alt-shift-space": "editor::ToggleCodeActions",

            "alt-f": "editor::Format",
            "alt-j": "editor::AddSelectionBelow",
            "alt-k": "editor::AddSelectionAbove",

            "alt-shift-i": "editor::SplitSelectionIntoLines",
            "alt-shift-j": "editor::MoveLineDown",
            "alt-shift-k": "editor::MoveLineUp",
            "alt-shift-r": "editor::RestartLanguageServer",
            "alt-shift-s": "editor::SortLinesCaseInsensitive"
        }
    },
    // Alias ctrl-w commands
    {
        "context": "VimControl && !menu",
        "bindings": {
            "f": [
                "vim::PushFindForward",
                { "before": false, "multiline": true }
            ],
            "t": [
                "vim::PushFindForward",
                { "before": true, "multiline": true }
            ],
            "shift-f": [
                "vim::PushFindBackward",
                { "after": false, "multiline": true }
            ],
            "shift-t": [
                "vim::PushFindBackward",
                { "after": true, "multiline": true }
            ],
            // Oil
            "-": [
                "task::Spawn",
                { "task_name": "oil", "reveal_target": "center" }
            ]
        }
    },
    // Use space as leader, enable subword navigation
    {
        "context": "VimControl && !menu && vim_mode != operator",
        "bindings": {
            "space": null, // Vim prefix key

            "w": "vim::NextSubwordStart",
            "b": "vim::PreviousSubwordStart",
            "e": "vim::NextSubwordEnd",
            "g e": "vim::PreviousSubwordEnd"
        }
    },
    // Use neovim's yank behavior: yank to end of line.
    {
        "context": "vim_mode == normal && !menu",
        "bindings": {
            "shift-y": ["workspace::SendKeystrokes", "y $"]
        }
    },
    // vim-surround
    {
        "context": "vim_mode == visual",
        "bindings": {
            "space s": "vim::PushAddSurrounds"
        }
    },
    // vim-sneak
    {
        "context": "vim_mode == normal || vim_mode == visual",
        "bindings": {
            "s": "vim::PushSneak",
            "shift-s": "vim::PushSneakBackward"
        }
    },
    {
        "context": "Editor && !menu",
        "bindings": {
            // vim default: return to normal mode
            "ctrl-c": "editor::Copy",
            // vim default: decrement
            "ctrl-x": "editor::Cut",
            // vim default: visual block mode
            "ctrl-v": "editor::Paste",
            // vim default: page down
            "ctrl-f": "buffer_search::Deploy"
        }
    },
    // Code Actions, Autocomplete
    {
        "context": "Editor && (showing_code_actions || showing_completions)",
        "bindings": {
            "alt-j": "editor::ContextMenuNext",
            "alt-k": "editor::ContextMenuPrevious"
        }
    },
    // Custom formatters
    {
        "context": "Editor && (extension == tf || extension == tfvars)",
        "bindings": {
            "alt-f": [
                "task::Spawn",
                {
                    "task_name": "tofu fmt",
                    "reveal_target": "dock" // doesn't actually pull up the terminal on error
                    // "reveal_target": "center" // causes screen flicker, but does pull up the terminal
                }
            ]
        }
    },
    {
        "context": "Editor && (extension == sql || extension == psql)",
        "bindings": {
            "alt-f": [
                "task::Spawn",
                {
                    "task_name": "pg_format",
                    "reveal_target": "dock" // doesn't actually pull up the terminal on error
                    // "reveal_target": "center" // causes screen flicker, but does pull up the terminal
                }
            ]
        }
    },
    // Mirror `.obsidian/keymap.json` for Markdown
    {
        "context": "Editor && (extension==md || extension==markdown || extension==mdx)",
        "bindings": {
            "alt-shift-v": "markdown::OpenPreviewToTheSide",

            // "ctrl-0": "editor:remove-heading"
            "ctrl-0": [
                "workspace::SendKeystrokes",
                "escape m m v : s / \\ ( ^ # * \\ s | ^ \\ s | ^ \\ ) / / enter escape ` m"
            ],
            // "ctrl-1": "editor:set-heading-1"
            "ctrl-1": [
                "workspace::SendKeystrokes",
                "escape m m v : s / \\ ( ^ # * \\ s | ^ \\ s | ^ \\ ) / # space / enter escape ` m"
            ],
            // "ctrl-2": "editor:set-heading-2"
            "ctrl-2": [
                "workspace::SendKeystrokes",
                "escape m m v : s / \\ ( ^ # * \\ s | ^ \\ s | ^ \\ ) / # # space / enter escape ` m"
            ],
            // "ctrl-3": "editor:set-heading-3"
            "ctrl-3": [
                "workspace::SendKeystrokes",
                "escape m m v : s / \\ ( ^ # * \\ s | ^ \\ s | ^ \\ ) / # # # space / enter escape ` m"
            ],
            // "ctrl-4": "editor:set-heading-4"
            "ctrl-4": [
                "workspace::SendKeystrokes",
                "escape m m v : s / \\ ( ^ # * \\ s | ^ \\ s | ^ \\ ) / # # # # space / enter escape ` m"
            ],
            // "ctrl-5": "editor:set-heading-5"
            "ctrl-5": [
                "workspace::SendKeystrokes",
                "escape m m v : s / \\ ( ^ # * \\ s | ^ \\ s | ^ \\ ) / # # # # # space / enter escape ` m"
            ],
            // "ctrl-6": "editor:set-heading-6"
            "ctrl-6": [
                "workspace::SendKeystrokes",
                "escape m m v : s / \\ ( ^ # * \\ s | ^ \\ s | ^ \\ ) / # # # # # # space / enter escape ` m"
            ],
            // "Insert code block" (needs improvement)
            "ctrl-~": [
                "workspace::SendKeystrokes",
                "escape i ` ` ` b a s h enter ` ` ` escape O"
            ],
            "ctrl-v": "editor::Paste"

            // TODO: Implement the rest of the keybindings
            //
            // "alt-/": "templater-obsidian:templates/template-info.md",
            // "alt-b": "editor:toggle-bullet-list",
            // "alt-c": "templater-obsidian:templates/template-task.md",
            // "alt-d": "insert-current-date",
            // "alt-enter": "templater-obsidian:jump-to-next-cursor-location",
            // "alt-g": "link-with-alias:create-link-with-alias",
            // "alt-i": "editor:toggle-italics",
            // "alt-m": "editor:toggle-inline-math",
            // "alt-n": "editor:toggle-numbered-list",
            // "alt-o": "link-with-alias:toggle-link-display-text",
            // "alt-s": "editor:toggle-source",
            // "alt-shift-d": "templater-obsidian:insert-templates/date.md",
            // "alt-shift-e": "open-with-default-app:show",
            // "alt-shift-m": "file-explorer:move-file",
            // "alt-shift-t": "templater-obsidian:templates/template-time.md",
            // "alt-shift-z": "editor:fold-all",
            // "alt-t": "insert-current-time",
            // "alt-w": "table-editor-obsidian:evaluate-formulas",
            // "alt-x": "templater-obsidian:templates/template-index.md",
            // "alt-y": "editor:toggle-highlight",
            // "alt-z": "editor:toggle-fold",
            // "ctrl-'": "mrj-jump-to-link:activate-jump-to-link",
            // "ctrl-`": "editor:toggle-code",
            // "ctrl-b": "editor:toggle-bold",
            // "ctrl-g": "editor:insert-link",
            // "ctrl-shift-c": "obsidian-tasks-plugin:toggle-done"
        }
    },
    {
        "context": "Editor && extension==md && vim_mode==visual",
        "bindings": {
            "ctrl-~": [
                "workspace::SendKeystrokes",
                "s ` a ` ` b a s h space escape d f ` o escape p f ` i enter ` ` escape b i backspace escape B i backspace escape V <"
            ]
        }
    }
]
