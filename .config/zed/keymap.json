// Rule of thumb - choose binds based on their CONTEXT:
//
// | MODIFIER         | CONTEXT                 | IMPLICATION                                                | EXAMPLE CONTEXTS   |
// | ---------------- | ----------------------- | ---------------------------------------------------------- | ------------------ |
// | `super`(`win`)   | SYSTEM  (e.g. Hyprland) | The bind will work regardless of which program is in focus | OS, window manager |
// | `alt`  (`opt`)   | PROCESS (e.g. Zed)      | The program in focus will handle the bind                  | Application        |
// | `ctrl` (`cmd`)   | THREAD  (e.g. Vim)      | A subprocess of the program in focus will handle the bind  | Plugin, website    |
//
// - Use `shift` in tandem with `super`, `alt`, or `ctrl` for related binds.
// - `shift` binds are less common and/or more impactful than those without.
//
// Examples:
//
// - Use Hyprland to focus an app with `super-a`; open a new instance of the app with `super-shift-a`
// - Use Zed to open a file with `alt-o`; open the file in a new window with `alt-shift-o`
// - Use Vim to scroll up with `ctrl-u`; scroll to the top of the file with `ctrl-shift-u`
//
// Ubiquitous binds that require special consideration:
//
//        Bind             Conflict(s)
// - `ctrl-c`: Copy    <> vim, terminal
// - `ctrl-f`: Find    <> vim
// - `ctrl-q`: Quit    <> vim, terminal
// - `ctrl-t`: New Tab <> vim
// - `ctrl-v`: Paste   <> vim, terminal
// - `ctrl-w`: Close   <> vim, terminal
// - `ctrl-x`: Cut     <> vim
// - `ctrl-z`: Undo    <> terminal
//
// Programs that cause conflicts with ubiquitous binds should be reconfigured.
//
// 1. Vim motions (`:help`)
//
//             Bind                            Suggested
//   - `ctrl-c`  : interrupt            => (unmap): Use `esc`
//   - `i_ctrl-f`: scroll forward       => (remap): e.g. `i_ctrl-d`
//   - `ctrl-q`  : visual block         => (unmap): Use Zed multicursor
//   - `ctrl-t`  : indent               => (unmap): Use Zed format
//   - `ctrl-v`  : visual block         => (unmap): Use Zed multicursor
//   - `ctrl-w`  : delete previous word => (remap): e.g. `i_ctrl-space`
//   - `ctrl-x`  : decrement            => (unmap): Use Zed command palette
//
// 2. GNU readline (`cheat readline`)
//
//             Bind                            Suggested
//   - `ctrl-c`: interrupt              => (remap): e.g. `ctrl-esc`
//   - `ctrl-q`: stop display           => (unmap): e.g. `ctrl-backspace`
//   - `ctrl-v`: next input verbatim    => (unmap)
//   - `ctrl-w`: delete previous word   => (remap): e.g. `ctrl-space`
//   - `ctrl-z`: suspend                => (remap): e.g. `ctrl-shift-esc`
//
// In `bash`, GNU `readline` handles the command prompt changes. This is why
// Suggested binds use `ctrl-*` - a subprocess handles them, not the terminal.

[
    {
        "bindings": {
            "alt-a": null, // Zed prefix key
            "ctrl-shift-c": null, // was: collaborator panel

            // Ensure ubiquitous keybinds aren't overridden by defaults
            "ctrl-c": null, // copy
            "ctrl-f": null, // find
            "ctrl-q": null, // quit
            "ctrl-t": null, // new tab
            "ctrl-v": null, // paste
            "ctrl-x": null, // cut
            "ctrl-z": null, // undo
            // "ctrl-w": null, // ðŸš§ need to rebind this in Vim and Terminal first

            // GUI navigation & view toggles
            "alt-,": ["task::Spawn", { "task_name": "Open settings" }],
            "alt-.": ["task::Spawn", { "task_name": "Open keymap" }],
            "alt-/": ["task::Spawn", { "task_name": "Open tasks" }],
            "alt-<": "zed::OpenDefaultSettings",
            "alt->": "zed::OpenDefaultKeymap",
            "alt-[": "workspace::ToggleLeftDock", // ðŸ
            "alt-]": "workspace::ToggleRightDock", // ðŸ
            "alt-h": "workspace::ActivatePaneLeft",
            "alt-l": "workspace::ActivatePaneRight",
            "alt-p": "file_finder::Toggle",
            "alt-shift-/": "vim::OpenDefaultKeymap",
            "alt-shift-a": "agent::ToggleFocus",
            "alt-shift-c": [
                "agent::NewExternalAgentThread",
                { "agent": "codex" }
            ],
            "alt-shift-g": "git_panel::ToggleFocus",
            "alt-shift-h": "workspace::ToggleLeftDock",
            "alt-shift-l": "workspace::ToggleRightDock",
            "alt-shift-p": "command_palette::Toggle",
            "ctrl-shift-i": "terminal_panel::Toggle" // ðŸš© should be `alt-shift-j`
        }
    },
    {
        "context": "Editor",
        "bindings": {
            "alt-a ctrl-r": "git::Restore",
            "alt-a ctrl-y": "editor::CopyFileName",
            "alt-f": "editor::Format",
            "alt-shift-r": "editor::RestartLanguageServer"
        }
    },
    // Re-assign ubiquitous keybinds
    {
        "context": "Editor",
        "bindings": {
            "ctrl-c": "editor::Copy", // vim default: return to normal mode
            "ctrl-f": "buffer_search::Deploy", // vim default: page down
            "ctrl-v": "editor::Paste", // vim default: visual block mode
            "ctrl-x": "editor::Cut", // vim default: decrement
            "ctrl-z": "editor::Undo"
            // - `ctrl-n`: New Window
            // - `ctrl-q`: Quit
            // - `ctrl-t`: New Tab
            // - `ctrl-w`: Close // ðŸš§ something is causing ctrl-w to be treated as the beginning of a chord
        }
    },
    {
        "context": "Markdown",
        "bindings": {
            "ctrl-c": "markdown::Copy"
        }
    },
    {
        "context": "ProjectPanel",
        "bindings": {
            "ctrl-c": "project_panel::Copy",
            "ctrl-v": "project_panel::Paste",
            "ctrl-x": "project_panel::Cut"
        }
    },
    {
        "context": "VariableList",
        "bindings": {
            "ctrl-c": "variable_list::CopyVariableValue"
        }
    },
    {
        "context": "KeymapEditor",
        "bindings": {
            "ctrl-c": "keymap_editor::CopyAction"
        }
    },
    {
        "context": "AcpThread > Editor",
        "use_key_equivalents": true,
        "bindings": {
            "ctrl-enter": "agent::Chat"
        }
    },
    // bind tab to accept even when there's an LSP completion and/or
    // the cursor isn't at the correct indentation level
    {
        "context": "Editor && edit_prediction_conflict",
        "bindings": {
            "tab": "editor::AcceptEditPrediction"
        }
    },
    // Navigate up/down in menus (command palette, file finder, code actions, completions)
    {
        "context": "CommandPalette || FileFinder",
        "bindings": {
            "alt-j": "menu::SelectNext",
            "alt-k": "menu::SelectPrevious",
            "alt-shift-j": "menu::SelectLast",
            "alt-shift-k": "menu::SelectFirst"
        }
    },
    {
        "context": "Editor && (showing_code_actions || showing_completions)",
        "bindings": {
            "alt-j": "editor::ContextMenuNext",
            "alt-k": "editor::ContextMenuPrevious",
            "alt-shift-j": "editor::ContextMenuLast",
            "alt-shift-k": "editor::ContextMenuFirst"
        }
    },
    // normal, visual, and insert mode
    {
        "context": "(VimControl || vim_mode == insert) && !menu",
        "bindings": {
            "alt-j": "editor::AddSelectionBelow",
            "alt-k": "editor::AddSelectionAbove",
            "alt-shift-i": "editor::SplitSelectionIntoLines",
            "alt-shift-j": "editor::MoveLineDown",
            "alt-shift-k": "editor::MoveLineUp",
            "alt-shift-s": "editor::SortLinesCaseInsensitive",
            "alt-shift-space": "editor::ToggleCodeActions",
            "alt-space": "editor::ShowCompletions"
        }
    },
    // normal & visual mode
    {
        "context": "VimControl && !menu",
        "bindings": {
            // vim-sneak
            "s": "vim::PushSneak",
            "shift-s": "vim::PushSneakBackward",

            // multiline find
            "f": [
                "vim::PushFindForward",
                { "before": false, "multiline": true }
            ],
            "shift-f": [
                "vim::PushFindBackward",
                { "after": false, "multiline": true }
            ],
            "shift-t": [
                "vim::PushFindBackward",
                { "after": true, "multiline": true }
            ],
            "t": ["vim::PushFindForward", { "before": true, "multiline": true }]
        }
    },
    // normal & visual mode when not waiting for another binding to trigger
    {
        "context": "VimControl && vim_mode != operator && !menu",
        "bindings": {
            // use space as leader
            "space": null,

            // enable subword navigation
            "w": "vim::NextSubwordStart",
            "b": "vim::PreviousSubwordStart",
            "e": "vim::NextSubwordEnd",
            "g e": "vim::PreviousSubwordEnd",

            // oil.nvim
            "-": [
                "task::Spawn",
                { "task_name": "oil", "reveal_target": "center" }
            ]
        }
    },
    // normal mode only
    {
        "context": "vim_mode == normal && !menu",
        "bindings": {
            // Use neovim's yank behavior: yank to end of line.
            "shift-y": ["workspace::SendKeystrokes", "y $"]
        }
    },
    // visual mode only
    {
        "context": "vim_mode == visual && !menu",
        "bindings": {
            // vim-surround
            "space s": "vim::PushAddSurrounds"
        }
    },
    // Jupyter Notebooks for TypeScript via Deno
    {
        "context": "Editor && jupyter && !ContextEditor",
        "bindings": {
            "alt-shift-backspace": "repl::ClearOutputs",
            "alt-shift-enter": "repl::Run"
        }
    },
    // Run `tofu fmt` to format Terraform files
    {
        "context": "Editor && (extension == tf || extension == tfvars)",
        "bindings": {
            "alt-f": [
                "task::Spawn",
                {
                    "task_name": "tofu fmt",
                    "reveal_target": "dock" // doesn't actually pull up the terminal on error
                    // "reveal_target": "center" // causes screen flicker, but does pull up the terminal
                }
            ]
        }
    },
    {
        "context": "Editor && (extension == md || extension == markdown)",
        "bindings": {
            "ctrl-shift-v": null,
            "ctrl-k v": null,
            "alt-shift-v": "markdown::OpenPreviewToTheSide"
        }
    }
]
